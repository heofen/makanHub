# makanHub - Музыкальный сервис

Простой музыкальный сервис с рекомендациями на основе CLAP + Annoy, построенный на Django.

## Установка и запуск

### 1. Предварительные требования

Убедитесь, что у вас установлены:

*   **Python** (версия 3.10+ рекомендуется)
*   **pip** (менеджер пакетов Python)
*   **Git** (система контроля версий)
*   **ffmpeg**: Необходим для обработки аудиофайлов библиотеками `torchaudio` и `librosa`.
    ```bash
    # Arch Linux
    sudo pacman -S ffmpeg
    # Debian/Ubuntu
    # sudo apt update && sudo apt install ffmpeg
    # MacOS (using Homebrew)
    # brew install ffmpeg
    ```
*   **libsndfile**: Необходима для библиотеки `soundfile`, используемой `librosa`.
    ```bash
    # Arch Linux
    sudo pacman -S libsndfile
    # Debian/Ubuntu
    # sudo apt install libsndfile1
    # MacOS (using Homebrew)
    # brew install libsndfile
    ```

### 2. Клонирование репозитория

```bash
git clone <url-репозитория> # Замените на URL вашего репозитория
cd makanhub # Или как называется папка проекта
```

### 3. Создание и активация виртуального окружения

Рекомендуется использовать виртуальное окружение для изоляции зависимостей.

```bash
python -m venv venv
source venv/bin/activate # Linux/MacOS
# venv\Scripts\activate # Windows
```

### 4. Установка Python-зависимостей

Все необходимые библиотеки перечислены в `requirements.txt`.

```bash
pip install -r requirements.txt
```
*Примечание: Установка `torch` и связанных библиотек (`torchaudio`, `transformers`) может занять некоторое время и потребовать значительного объема дискового пространства.* 

### 5. Настройка базы данных

Применяем миграции для создания структуры БД (используется SQLite по умолчанию).

```bash
python manage.py makemigrations core
python manage.py migrate
```

### 6. Создание суперпользователя

Создаем учетную запись администратора для доступа к админ-панели Django (`/admin/`).

```bash
python manage.py createsuperuser
```
Следуйте инструкциям в терминале для ввода имени пользователя, email (опционально) и пароля.

### 7. Запуск сервера разработки

```bash
python manage.py runserver
```
Сервер будет доступен по адресу `http://127.0.0.1:8000/`.

Чтобы сервер был доступен с других устройств в вашей локальной сети, используйте:
```bash
python manage.py runserver 0.0.0.0:8000 
```
*Примечание: Убедитесь, что ваш фаервол разрешает входящие подключения на порт 8000.* 

### 8. Первоначальное использование

1.  **Загрузка треков**: Перейдите на `http://127.0.0.1:8000/new_track/` и загрузите несколько аудиофайлов (например, MP3, WAV). При загрузке для каждого трека будет автоматически определена длительность и сгенерирован CLAP-эмбеддинг (это может занять время, следите за логами сервера).
2.  **Построение индекса Annoy**: После загрузки треков выполните в терминале команду:
    ```bash
    python manage.py build_annoy_index
    ```
    Эта команда создаст или обновит файл `annoy_index.ann` в корне проекта, который используется для быстрого поиска похожих треков.
3.  **Просмотр рекомендаций**: Откройте страницу любого загруженного трека (например, с главной страницы `http://127.0.0.1:8000/`) и нажмите кнопку "Показать похожие треки".

## Структура проекта

*   `makanhub/`: Основная папка конфигурации Django (`settings.py`, `urls.py`).
*   `core/`: Приложение Django с основной логикой:
    *   `models.py`: Модели данных (User, Track, Genre, etc.).
    *   `views.py`: Представления (обработчики запросов).
    *   `forms.py`: Формы Django.
    *   `urls.py`: URL-маршруты приложения `core`.
    *   `admin.py`: Настройки админ-панели.
    *   `utils.py`: Вспомогательные функции (генерация CLAP эмбеддинга).
    *   `annoy_service.py`: Сервис для работы с Annoy.
    *   `management/commands/`: Пользовательские manage.py команды (`build_annoy_index`).
    *   `migrations/`: Файлы миграций базы данных.
    *   `templates/core/`: Шаблоны HTML для приложения `core`.
*   `templates/`: Общие шаблоны (например, `base.html`).
*   `media/`: Папка для загруженных медиафайлов (треки, обложки).
*   `venv/`: Виртуальное окружение Python (если создано).
*   `db.sqlite3`: Файл базы данных SQLite (по умолчанию).
*   `manage.py`: Утилита Django для управления проектом.
*   `requirements.txt`: Список Python-зависимостей.
*   `annoy_index.ann`: Файл индекса Annoy (генерируется командой).
*   `README.md`: Этот файл. 